<html>
	<head>
		<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>	
		
		<script type="text/javascript">
		
			function logMeIn(fb_id, name, email) {
				$.ajax({
					type: 'POST',
					url: 'https://localhost/ge_backend/user_login.php',
					data: {
					'fb_id' : fb_id,
					'provided_name' : name,
					'provided_email' : email
					},
					success: function(data) {
						console.log('Logged in ' + data);
					},
					error: function(jqXHR, text, error) {
						console.log('error in ajax: ' + text + " " + error);
					} 
				});
				
			}
			
		</script>
	</head>
	<body>
		<script>
	
			function onLogin(response) {
			  if (response.status == 'connected') {
			    FB.api('/me?fields=id,first_name,email', function(data) {
			      var welcomeBlock = document.getElementById('fb-welcome');
			      welcomeBlock.innerHTML = 'Hello, ' + data.first_name + '!';
			      
			      logMeIn(data.id, data.first_name, data.email);
			    });
			    
			    FB.api('/me/friends', function(result) {
			    	var friend_block = document.getElementById('friend_list');
			    	
			    	//console.log(result);
			    	result.data.forEach(function(elem){
			    		//console.log(elem);
			    		var newLi = document.createElement('li');
			    		newLi.innerHTML = elem.name;
			    		
			    		friend_block.appendChild(newLi);
			    	});
			    });
			    
			    
			  }
			}		  
		  
		  window.fbAsyncInit = function() {
		    FB.init({
		      appId      : '801584073328158',
		      xfbml      : true,
		      version    : 'v2.8'
		    });
		    FB.AppEvents.logPageView();
		    
		    FB.getLoginStatus(function(response) {
			  // Check login status on load, and if the user is
			  // already logged in, go directly to the welcome message.
			  if (response.status == 'connected') {
			    onLogin(response);
			  } else {
			    // Otherwise, show Login dialog first.
			    FB.login(function(response) {
			      onLogin(response);
			    }, {scope: 'user_friends, email'});
			  }
			});
		  };
		
		  (function(d, s, id){
		     var js, fjs = d.getElementsByTagName(s)[0];
		     if (d.getElementById(id)) {return;}
		     js = d.createElement(s); js.id = id;
		     js.src = "//connect.facebook.net/en_US/sdk.js";
		     fjs.parentNode.insertBefore(js, fjs);
		   }(document, 'script', 'facebook-jssdk'));
		   		  
		  
			
		</script>	
		<h1>Moja FB igra 30</h1>
		
		<p id="fb-welcome"></p>
		
		<ol id="friend_list">
					
		</ol>
	</body>
</html>
